# 4.1 Documento de Arquitetura de Software (DAS)

## 4.1.1 Introdução

Este documento descreve a arquitetura do sistema **Planetário Virtual**, que visa proporcionar aos usuários uma experiência imersiva de observação de corpos celestes em um ambiente digital interativo. O documento detalha a representação arquitetural, os componentes principais, restrições e critérios de qualidade.

## 4.1.2 Representação Arquitetural

A arquitetura do sistema adota uma abordagem **cliente-servidor** com **frontend web interativo** e um **backend RESTful**. Os principais componentes são:

  - Aplicação Web (navegador) com visualização 3D
  - Servidor de aplicação (API REST)
  - Base de dados (JSON)

O estilo arquitetural predominante é **arquitetura em camadas**, separando apresentação, lógica de negócio e persistência de dados.

## 4.1.3 Metas e Restrições Arquiteturais

**Metas:**

  - Fornecer renderização 3D em tempo real de corpos celestes
  - Permitir consultas dinâmicas de dados astronômicos
  - Suportar acesso simultâneo de múltiplos usuários

**Restrições:**

  - Compatibilidade com navegadores modernos (Chrome, Firefox, Edge)
  - Uso de dados públicos de APIs externas (ex.: NASA)
  - Performance aceitável em hardware de especificação média

## 4.1.4 Visualização Caso de Uso

Os principais casos de uso incluem:

  - **Consultar corpo celeste:** Usuário seleciona um objeto e visualiza detalhes.
  - **Interagir no fórum:** Criar e responder postagens.



<font size="3"><p style="text-align: center"><b>Figura 1:</b> Representação UML do Padrão Factory Method (Clássico) </p></font>
<center>

![Caso Uso](./assets/DiagramaCasoUso.png)

</center>

<font size="3"><p style="text-align: center"><b>Autora</b>: [Milena Rocha](https://github.com/milenafrocha), 2025.</p></font>

## 4.1.5 Visualização Lógica

A visualização lógica organiza os componentes em camadas:

  * **Camada de Apresentação**

      * Interface Web (HTML, CSS, JavaScript, Next)

  * **Camada de Lógica**

      * API REST (FastAPI)

  * **Camada de Persistência**

      * Banco de dados (JSON)
      * Cache local para otimizar consultas

## 4.1.6 Visualização de Processo

Os processos são distribuídos em:

  * **Processo do Cliente:** Renderização gráfica e interação do usuário.
  * **Processo do Servidor:** Exposição de API REST, autenticação e agregação de dados.
  * **Processo de Sincronização de Dados:** Job que periodicamente atualiza o banco com dados astronômicos de APIs externas.

## 4.1.7 Visualização de Deploy

A infraestrutura é implantada em nuvem:

  * **Frontend:** Render
  * **Backend e Banco de Dados:** Render


<font size="3"><p style="text-align: center"><b>Figura 2:</b> Arquitetura em Camadas </p></font>
<center>

![Camadas](./assets/arquiteturaCamadas.png)

</center>

<font size="3"><p style="text-align: center"><b>Autora</b>: [Milena Rocha](https://github.com/milenafrocha), 2025.</p></font>


## 4.1.8 Visualização de Implementação

O repositório é organizado da seguinte forma:

```
── projeto
    ├── grupo1
    │   ├── README.md
    │   ├── backend
    │   │   ├── .gitkeep
    │   │   ├── README.md
    │   │   ├── api.md
    │   │   ├── app
    │   │   │   ├── __init__.py
    │   │   │   ├── data_classes
    │   │   │   │   ├── comentario_data.py
    │   │   │   │   ├── postagem_data.py
    │   │   │   │   └── user_data.py
    │   │   │   ├── decorators
    │   │   │   │   └── auth_decorator.py
    │   │   │   ├── main.py
    │   │   │   ├── models
    │   │   │   │   ├── comentario_model.py
    │   │   │   │   ├── postagem_model.py
    │   │   │   │   └── user_model.py
    │   │   │   ├── routers
    │   │   │   │   ├── comentario_router.py
    │   │   │   │   ├── postagem_router.py
    │   │   │   │   └── user_router.py
    │   │   │   ├── services
    │   │   │   │   ├── comentario_service.py
    │   │   │   │   ├── forum_service.py
    │   │   │   │   └── postagem_service.py
    │   │   │   └── utils.py
    │   │   ├── backup-db.json
    │   │   ├── db.json
    │   │   └── requirements.txt
    │   └── frontend
    │       ├── .gitignore
    │       ├── README.md
    │       ├── eslint.config.mjs
    │       ├── next.config.ts
    │       ├── package-lock.json
    │       ├── package.json
    │       ├── postcss.config.mjs
    │       ├── public
    │       │   ├── file.svg
    │       │   ├── globe.svg
    │       │   ├── logo.svg
    │       │   ├── next.svg
    │       │   ├── vercel.svg
    │       │   └── window.svg
    │       ├── src
    │       │   ├── app
    │       │   │   ├── (auth)
    │       │   │   │   └── login
    │       │   │   │       └── page.tsx
    │       │   │   ├── (main)
    │       │   │   │   ├── layout.tsx
    │       │   │   │   ├── meu-perfil
    │       │   │   │   │   └── page.tsx
    │       │   │   │   ├── page.tsx
    │       │   │   │   ├── postagens
    │       │   │   │   │   └── [id]
    │       │   │   │   │       └── page.tsx
    │       │   │   │   └── usuarios
    │       │   │   │       └── page.tsx
    │       │   │   ├── favicon.ico
    │       │   │   ├── globals.css
    │       │   │   ├── layout.tsx
    │       │   │   └── lib
    │       │   │       └── sortingStrategies.ts
    │       │   ├── components
    │       │   │   ├── auth
    │       │   │   │   └── LoginControls.tsx
    │       │   │   ├── forum
    │       │   │   │   ├── CommentForm.tsx
    │       │   │   │   ├── CreatePostForm.tsx
    │       │   │   │   ├── PostDetailView.tsx
    │       │   │   │   ├── PostItem.tsx
    │       │   │   │   └── PostList.tsx
    │       │   │   ├── layout
    │       │   │   │   ├── Footer.tsx
    │       │   │   │   └── Navbar.tsx
    │       │   │   ├── providers
    │       │   │   │   └── ToastProvider.tsx
    │       │   │   └── users
    │       │   │       └── UserCard.tsx
    │       │   ├── contexts
    │       │   │   └── AuthContext.tsx
    │       │   └── services
    │       │       ├── api.ts
    │       │       └── apiAdapters.ts
    │       └── tsconfig.json
```

Cada módulo é versionado independentemente.

## 4.1.9 Visualização de Dados

O modelo de dados principal inclui:

<font size="3"><p style="text-align: center"><b>Figura 3:</b> DER </p></font>
<center>

![DER](./assets/der.png)

</center>

<font size="3"><p style="text-align: center"><b>Autora</b>: [Milena Rocha](https://github.com/milenafrocha), 2025.</p></font>

### MER – Modelo Entidade Relacionamento

Entidades e Relacionamentos

#### **USUÁRIO**

  * **Atributos:**

      * `id_usuario` (PK)
      * `nome`
      * `tipo`

  * **Relacionamentos:**

      * *Escreve* POSTAGEM (1:N)
      * *Comenta* COMENTARIO (1:N)

-----

#### **POSTAGEM**

  * **Atributos:**

      * `id_postagem` (PK)
      * `conteudo`
      * `data_criacao`
      * `autor_id` (FK)

  * **Relacionamentos:**

      * *Recebe* COMENTARIO (1:N)

-----

#### **COMENTARIO**

  * **Atributos:**

      * `id_comentario` (PK)
      * `conteudo`
      * `data_criacao`
      * `autor_id` (FK)
      * `postagem_id` (FK)

-----

### DLD – Dicionário de Dados

#### Tabela: USUARIO

| Campo       | Tipo | Chave | Obrigatório | Descrição                      |
| ----------- | ---- | ----- | ----------- | ------------------------------ |
| id\_usuario | int  | PK    | Sim         | Identificador único do usuário |
| nome        | text |       | Sim         | Nome do usuário                |
| tipo        | text |       | Sim         | Tipo de usuário (ex.: comum)   |

-----

#### Tabela: POSTAGEM

| Campo         | Tipo     | Chave | Obrigatório | Descrição                          |
| ------------- | -------- | ----- | ----------- | ---------------------------------- |
| id\_postagem  | int      | PK    | Sim         | Identificador único da postagem    |
| conteudo      | text     |       | Sim         | Conteúdo textual da postagem       |
| data\_criacao | datetime |       | Sim         | Data e hora de criação da postagem |
| autor\_id     | int      | FK    | Sim         | Referência ao usuário autor        |

-----

#### Tabela: COMENTARIO

| Campo          | Tipo     | Chave | Obrigatório | Descrição                             |
| -------------- | -------- | ----- | ----------- | ------------------------------------ |
| id\_comentario | int      | PK    | Sim         | Identificador único do comentário    |
| conteudo       | text     |       | Sim         | Conteúdo textual do comentário       |
| data\_criacao  | datetime |       | Sim         | Data e hora de criação do comentário |
| autor\_id      | int      | FK    | Sim         | Referência ao usuário autor          |
| postagem\_id   | int      | FK    | Sim         | Referência à postagem comentada      |

-----

#### Resumo dos Relacionamentos

  * **USUARIO – POSTAGEM**
    1:N (Um usuário pode escrever muitas postagens)

  * **USUARIO – COMENTARIO**
    1:N (Um usuário pode escrever muitos comentários)

  * **POSTAGEM – COMENTARIO**
    1:N (Uma postagem pode receber muitos comentários)

## 4.1.10 Qualidade

Critérios de qualidade incluem:

  * **Usabilidade:** Interface intuitiva e responsiva
  * **Segurança:** HTTPS, autenticação JWT, validação de input
  * **Escalabilidade:** Capacidade de atender crescimento de usuários e dados

## 4.1.11 Código Comprobatório

Esta seção contém evidências práticas que demonstram como os padrões arquiteturais descritos foram implementados no código. O sistema adota uma abordagem cliente-servidor com um frontend web interativo e um backend RESTful, predominantemente seguindo uma arquitetura em camadas.

#### 4.1.11.1 Exemplo de Código: Padrão Cliente-Servidor

##### Código do Cliente (Frontend - Next.js/React):

O componente CreatePostForm é responsável por capturar o conteúdo da nova postagem. Ele utiliza a função onPostSubmit para enviar o texto para a camada de serviço do frontend. A função createPostAPI encapsula a lógica da chamada HTTP para o backend, enviando os dados da postagem.

```typescript
import { useState } from 'react';

type CreatePostFormProps = {
  onPostSubmit: (postText: string) => void;
};

export function CreatePostForm({ onPostSubmit }: CreatePostFormProps) {
  const [text, setText] = useState('');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (text.trim()) {
      onPostSubmit(text);
      setText('');
    }
  };

  return (
    <form onSubmit={handleSubmit} className="mb-8 bg-gray-800 border border-gray-700 p-4 rounded-lg">
      <h2 className="text-xl font-semibold text-white mb-3">Criar Nova Postagem</h2>
      <textarea
        value={text}
        onChange={(e) => setText(e.target.value)}
        className="w-full p-2 bg-gray-700 text-gray-200 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="O que você está pensando sobre o universo?"
        rows={4}
      />
      <div className="text-right mt-3">
        <button
          type="submit"
          className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300 disabled:opacity-50"
          disabled={!text.trim()}
        >
          Publicar
        </button>
      </div>
    </form>
  );
}
```

A chamada de API é feita pela função createPostAPI:

```typescript
// frontend/src/services/api.ts
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://127.0.0.1:8000';

// ... (outros tipos e funções)

export const createPostAPI = async (texto: string, autorId: number): Promise<Post> => {
  const endpoint = `${API_BASE_URL}/api/postagens/`;
  try {
    const response = await fetch(endpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ conteudo: texto, autor_id: autorId }),
    });
    if (!response.ok) {
      let errorMessage = `Erro ${response.status} ao criar o post.`;
      try { const errorData = await response.json(); errorMessage = errorData.detail || errorData.message || errorMessage; }
      catch { const textError = await response.text(); errorMessage = textError || response.statusText || errorMessage; }
      throw new Error(errorMessage);
    }
    const createdApiPost: ApiCreatedPostResponse = await response.json();
    return PostAPIAdapter.toCreatedPost(createdApiPost);
  } catch (error) {
    console.error("Frontend: Falha crítica ao criar post.", error);
    if (error instanceof Error) throw error;
    throw new Error("Não foi possível conectar à API para criar o post.");
  }
};
```

##### Código do Servidor (Backend - Python/FastAPI):

No backend, o endpoint correspondente é definido no roteador de postagens (postagem_router.py). Ele recebe a requisição HTTP POST, processa os dados (PostCreate), e retorna a resposta formatada (PostResponse).

```python
# postagem_router.py
from fastapi import APIRouter, HTTPException, status,Request
from typing import List
from ..services.postagem_service import post_service
from ..models.postagem_model import PostCreate, PostResponse
from app.decorators.auth_decorator import VerificadorPermissaoFactory

router = APIRouter(
    prefix="/postagens",
    tags=["Postagens"]
)

# ... (outros endpoints)

@router.post("/", response_model=PostResponse, status_code=status.HTTP_201_CREATED)
async def criar_postagem(post: PostCreate):
    return post_service.create_post(post)

# ... (outros endpoints)
```
## Histórico de Versões

| Versão | Data       | Descrição                                      | Autor               | Revisor            |
|--------|------------|------------------------------------------------|---------------------|--------------------|
| 1.0    | 02/07/2025 | Criação do documento  | [Milena Rocha](https://github.com/milenafrocha)| [Taynara Vitorino](https://github.com/taybalau), [Antonio Júnior](https://github.com/antonioleaojr), [Carlos Eduardo de Sousa Paz](https://github.com/dudupaz), [Raphaela Guimarães de Araújo dos Santos](https://github.com/raphaiela) |
| 2.0    | 03/07/2025 | Adição do Código Comprobatório  | [Taynara Vitorino](https://github.com/taybalau)|[Milena Rocha](https://github.com/milenafrocha), [Antonio Júnior](https://github.com/antonioleaojr), [Carlos Eduardo de Sousa Paz](https://github.com/dudupaz), [Raphaela Guimarães de Araújo dos Santos](https://github.com/raphaiela) |
